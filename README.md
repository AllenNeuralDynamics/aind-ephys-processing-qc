# Quality Control for AIND ephys pipeline
## aind-ephys-processing-qc


### Description

This capsule is designed to compute Metrics following the `QualityControl` schema
form `aind-data-schema`.

The following metrics are computed:

- **Raw data**: snippets of AP and LFP traces at multiple points over the session
- **PSD**: Power Spectrum Density of wide band, high and low freq also over depth
- **Noise**: RMS channel values of raw data and preprocessed data
- **Drift**: raster map and estimated drift
- **Saturation**: how many positive/negative saturation events and trace snippets around them
- **Event triggers**: average response to selected HARP events (defaults: licks and optogenetics stimulation). This metric needs HARP behavior events.
- **Unit Yield**: distrubution of ISI violation ratios, amplitude cutoff, presence ratio, unit depths, amplitudes, firing rate and their classification (SUA, MUA, noise)
- **Firing rate**: population firing rate over the session (to detect seizure-like or drops in activity)


### Inputs

The `data/` folder must include the output of the raw data, the output of the [`result-collector`](https://github.com/AllenNeuralDynamics/aind-ephys-results-collector) caspule, and at least one JSON file generated by the [aind-ephys-job-dispatch](https://github.com/AllenNeuralDynamics/aind-ephys-job-dispatch) capsule is required. 

### Parameters

The `code/run` script takes no arguments.


### Output

The capsule produces the following output for each input JSON file:

- `results/quality_control_{recording_name}.json` file, representing a valid `aind_data_schema.core.QualityControl` object.
- `results/quality_control_{recording_name}` folder, with reference figures for the `quality_control_{recording_name}.json` file.

